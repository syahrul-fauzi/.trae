{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SBA-Agentic Rule Schema",
  "type": "object",
  "required": ["id", "name", "trigger", "action", "metadata"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[A-Z]{2,4}-[A-Z]{2,4}-[0-9]{2}$"
    },
    "name": { "type": "string" },
    "description": { "type": "string" },
    "trigger": {
      "type": "object",
      "properties": {
        "type": { "enum": ["event", "schedule"] },
        "events": { "type": "array", "items": { "type": "string" } },
        "conditions": { "type": "array", "items": { "type": "string" } },
        "cron": { "type": "string" },
        "timezone": { "type": "string" }
      }
    },
    "action": {
      "type": "object",
      "required": ["steps"],
      "properties": {
        "steps": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["op", "ref"],
            "properties": {
              "op": { "enum": ["tool", "api", "queue", "db"] },
              "ref": { "type": "string" },
              "input": { "type": "object" }
            }
          }
        },
        "integration": { "type": "string" }
      }
    },
    "constraints": {
      "type": "object",
      "properties": {
        "validation": { "type": "string" },
        "access_control": { "type": "array", "items": { "type": "string" } },
        "dependencies": { "type": "array", "items": { "type": "string" } }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["version", "priority", "category"],
      "properties": {
        "version": { "type": "string" },
        "priority": { "enum": ["low", "medium", "high", "critical"] },
        "category": { "enum": ["BPA", "CX", "DA", "SI"] }
      }
    }
  }
}
